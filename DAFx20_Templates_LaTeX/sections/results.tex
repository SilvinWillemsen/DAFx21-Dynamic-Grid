\section{Analysis and Results}\label{sec:results}
% \subsection{Expected behaviour}
This section shows the analysis of the system presented in the previous section and its behaviour.
\subsection{Energy \SWcomment[Added this for your (SB, MD) review]}
\SWcomment[I guess the most important thing I want to highlight using this section is the fact that in the static case, the energy can be shown to be constant, even when $\alpha \neq 0$. This means that the proposed method (without displacement correction) does not introduce losses! 
My question to you: do you see a way (perhaps from the last terms in system \eqref{eq:FDSwithMethod} or the boundary terms in Eq. \eqref{eq:boundaryTerms}) to prove that the total energy of the system is static when $\alpha$ is static?]

The energy of system \eqref{eq:FDSwithMethod} (which after expansion at the inner boundaries simply becomes \eqref{eq:innerboundariesExpanded}) can be retrieved using energetic analysis techniques \cite{bilbao2009} and a weighted inner product yielding
\begin{equation}
    \delta_{t+}\left(\mathfrak{h}_u + \mathfrak{h}_w\right) = \mathfrak{b}_u + \mathfrak{b}_w
\end{equation}
with 
\begin{align}
&\begin{aligned}
    \mathfrak{h}_u =&\  \frac{1}{2}\sum_{\lu=0}^{M-1}h\Big((\delta_{t-}u_\lu^n)^2 + c^2 (\delta_{x+}u_\lu^n)(\delta_{x+}u_\lu^{n-1})\Big) \\
    &+ \frac{\epsilon}{4}h(\delta_{t-}u_M^n)^2,
\end{aligned}
\\
&\begin{aligned}
    \mathfrak{h}_w=&\ \frac{1}{2}\sum_{\lw=1}^{M_w} h\Big((\delta_{t-}w_\lw^n)^2+c^2(\delta_{x-}w_\lw^n)(\delta_{x-}w_\lw^{n-1}) \Big)\\
    &+ \frac{\epsilon}{4}h(\delta_{t-}w_0^n)^2,
    \end{aligned}
\end{align}
and 
\begin{equation}\label{eq:boundaryTerms}
    \begin{aligned}
    \mathfrak{b}_u &= c^2(\delta_{t\cdot}u_M^n)\left((\delta_{x-}u_M^n)+\frac{\epsilon}{2}h(\delta_{xx}u_M^n)\right) \quad \text{and}\\
    \mathfrak{b}_w &= c^2(\delta_{t\cdot}w_0^n)\left(-(\delta_{x+}w_0^n)+\frac{\epsilon}{2}h(\delta_{xx}w_0^n)\right)
    \end{aligned}
\end{equation}
with $\epsilon = \alpha + 1$. \SWcomment[When $\alpha = 0$, $u_M^n = w_0^n$ and the boundary terms vanish. When $\alpha \rightarrow 1$ the boundary terms reduce to 
\begin{equation}
    \mathfrak{b}_u+\mathfrak{b}_w = -\frac{c^2}{2}\delta_{t+}\big(h(\delta_{x+}u_M^n)(\delta_{x+}u_M^{n-1})\big),  
\end{equation}
which is essentially the potential energy between the inner boundaries. See Appendix B.4 (p. 17) in \url{https://www.overleaf.com/project/5eec78b95071c2000121fff4} for a derivation.]
% \subsection{Static}
\subsection{Modes}
% In order to determine whether the proposed method yields an output with the correct frequency content in the static case, a spectrum is taken of the system's output. The system with $N=15.5$ (so $\alpha = 0.5$ in \eqref{eq:bMat}) at a sample rate of $f_\text{s} = 44100$ Hz is compared to the same system with $f_\text{s} = 88200$ Hz resulting in $N=31$ ($\alpha = 0$) for the same $f_0$ according to Eq. \eqref{eq:fundamentalFreq}. See Figure \ref{fig:spectra}.

% \begin{figure}[ht]
%     \centering
% %% \reprintcolumnwidth is the same in preprint and reprint for
% %% ease of use for authors:
% \includegraphics[width=0.8\columnwidth]{Figures/spectraDoubleSampleRateQuadratic.eps}
% \caption{\label{fig:spectra}{A system with $N = 15.5$ at $f_\text{s} = 44100$} compared to a system with $N = 31$ at $f_\text{s} = 88200$. Both are supposed to have the same fundamental frequency $f_0$ according to Eq. \eqref{eq:fundamentalFreq}.}
% \end{figure} 

% As expected, the output of the system at integer $N = 31$ contains partials at perfect integer multiples of $f_0$ (Eq. \eqref{eq:fundamentalFreq}). When this is compared to the output of the system with $N = 15.5$, one can observe that the lower partials are nearly perfectly overlapping, whereas higher partials exhibit slight downwards deviations, exponentially increasing with frequency.

% % \subsection{Dynamic}
%For a more detailed look at the behaviour of the system when $c$ is changed dynamically, 
% Rewriting \eqref{eq:totalSystem} in one-step form \cite{bilbao2009}, 
% \begin{equation}\label{eq:oneStepForm}
%     \begin{bmatrix}
%         \U^{n+1}\\
%         \U^n
%     \end{bmatrix} = 
%     \underbrace{\begin{bmatrix}
%         \mathbf{C}_+^{-1}\mathbf{B} & \mathbf{C}_+^{-1}\mathbf{C}_-\\
%         \mathbf{I} & \mathbf{0}
%     \end{bmatrix}}_{\mathbf{Q}}
%     \begin{bmatrix}
%         \U^n\\
%         \U^{n-1}
%     \end{bmatrix}
% \end{equation}
% allows for a modal analysis to be performed. For static parameters, the complex frequency of the $p$'th mode can be retrieved as
% \begin{equation}\label{eq:modalAnalysis}
%     s_p = \frac{1}{k}\ln \left(\text{eig}_p(\mathbf{Q})\right),
% \end{equation}
% where the frequency (in Hz) and damping (in $s^{-1}$) of the $p$'th mode can be retrieved using $f_p = \mathfrak{I}(s_p)/2\pi$ and $\sigma_p = \mathfrak{R}(s_p)$
% % \begin{equation}
% %     f_p = \mathfrak{I}(s_p)/2\pi \quad \text{and} \quad \sigma_p = \mathfrak{R}(s_p)
% % \end{equation}
% respectively. Here, $\mathfrak{I}(\cdot)$ and $\mathfrak{R}(\cdot)$ denote the `imaginary' and `real part of'. These definitions still hold for slow variations of $c$. 
A modal analysis can be performed on system \eqref{eq:totalSystem} while changing $c^n$ to obtain the frequencies and damping coefficients for each mode. As a test case, the wave speed of a system running at $f_\text{s} = 44100$ Hz is dynamically varied from $c^0 = 2940$ ($\Nfrac^0 = 15$) to $c^{n_\text{end}} = 2205$ ($\Nfrac^{n_\text{end}} = 20$) where $n_\text{end}$ is the last sample of the simulation. %, changing $\mathbf{Q}$ and thus the modal frequencies over time. %The displacement correction presented in Section. \ref{sec:dispCorr} is not included in this analysis ($\varepsilon \gg 1$), but will be elaborated on in Section \ref{sec:dispCorrRes}. 
The results of the analysis are shown in Figure \ref{fig:modalAnalysis} where higher damping (induced by the displacement correction) is indicated using thinner and bluer lines. Figure \ref{fig:spectrogram} shows the resulting spectrogram, with the displacement correction deactivated, of the system excited with $u_1^0 = 1$ and the output retrieved at $u_1^n$, and Figure \ref{fig:spectrogramDamp} shows a system with the same excitation but the change in $c$ inverted ($\Nfrac=20\rightarrow 15$) and displacement correction activated.

\begin{figure}[ht!]
    \centering
    \subfloat[]{\label{fig:modalAnalysis}{ \includegraphics[width=0.96\columnwidth]{Figures/modalAnalysisDampingNarrow.eps}}}\\
    \vspace{-1em}\subfloat[]{\label{fig:spectrogram}{ \includegraphics[width=0.95\columnwidth]{Figures/specQuadratic2NarrowNoScale.eps}}}\\
    \vspace{-1em}\subfloat[]{\label{fig:spectrogramDamp}{ \includegraphics[width=0.95\columnwidth]{Figures/specQuadratic2DampNarrowNoScale.eps}}}
    \vspace{-1em}\caption{{\it Experiments showing (linearly) varying wave speed between $c^0 = 2940$ ($\Nfrac^0 = 15$) and} $c^{n_\text{end}} = 2205$ {\it (}$\Nfrac^{n_\text{end}} = 20$) {\it with $M^n = N^n - 1$ and $M_w^n = 1$ running at $f_\text{s} = 44100$ Hz. (a) Modal analysis of system \eqref{eq:totalSystem}% using \eqref{eq:modalAnalysis}
    . Thinner and bluer lines indicate a higher amount of damping. (b) Output of the system while decreasing $c^n$ ($\Nfrac^n = 15 \rightarrow 20$) without displacement correction, excited with a narrow raised cosine at $n=0$ retrieved at $u_1^n$. The sound output follows the same pattern as predicted by the analysis shown in Figure \ref{fig:modalAnalysis}. (c) Output of the system while increasing $c^n$ ($\Nfrac^n = 20 \rightarrow 15$) with displacement correction activated (essentially flipping the analysis in Figure \ref{fig:modalAnalysis} along the x-axis). \SWcomment[Higher frequencies are filtered out and prevent artefacts.]}\label{fig:analysisAndSpecs}}
\end{figure}
In the following, %\SWcomment[came up with this measure myself.. it made sense to me for measuring harmonic deviation / inharmonicity. Please let me know if you know a better measure or something I can reference]
% \begin{equation}
%     \varepsilon_p = \frac{f_p - pf_0}{f_0}\quad \text{[\%]}
% \end{equation}
% is used to calculate the harmonic deviation of mode $p$ from an integer multiple of the fundamental. Furthermore, 
the lowest mode generated by the analysis is referred to as $f_1$ and should ideally be equal to $f_0$ calculated using Eq. \eqref{eq:fundamentalFreqCont}. %To measure how much a mode deviates from a perfect harmonic, cents will be used \SWcomment[according to $1200\cdot\text{log}_2(f_p / pf_0)$].
%
The first thing one can observe from Figure \ref{fig:modalAnalysis} is that the frequencies of the modes decrease as $c$ decreases (as desired). The lower the mode, the more linear this decrease happens. Between $\Nfrac = 15$ and $\Nfrac = 16$, $f_1$ maximally deviates by $-0.15$ cents. In this same interval $f_{15}$ maximally deviates by $-67$ cents. This deviation %for mode number $p$
gets %progressively
less as $\Nfrac$ increases. %The maximum deviation for the highest mode number $f_{\lfloor N\rfloor}$, however, gets larger with a larger $N$, with $\text{max}(\varepsilon_{\lfloor N \rfloor})$ approaching $-100\%$ for extremely large values of $N$ ($>1000$). These deviations only happen between integer values of $N$ where at integer $N$ all modes are perfect integer multiples of $f_0$ and $\varepsilon_p = 0 \%$ for all $p$.
%
Experiments with higher even-ordered Lagrange interpolators shows that these frequency deviations become smaller, but not by a substantial amount. The quadratic interpolator has thus been chosen for being simpler and more flexible while not being substantially worse than higher order interpolators.

Another observation from Figure \ref{fig:modalAnalysis} is that there are always $N$ modes present, corresponding to the number of moving points of the system. As can be seen from the spectrum in Figure \ref{fig:spectrogram} the highest mode is not excited. If the system is excited when $\Nfrac$ is not an integer, the highest mode will also be excited.
When an implementation of the system using this method with integer $\Nfrac$ (static) is compared to a normal implementation of the 1D wave equation (shown in Section \ref{sec:FDTD}) with the same value $N$, identical outputs are observed, even though the latter has $N-1$ moving points. \SWcomment[this confirms that \eqref{eq:totalSystem} reduces to the normal case when $\alpha = 0$]

Using the quadratic interpolation from \eqref{eq:connectionInterpol}, or any other even-ordered Lagrange interpolator for that matter, the modal frequencies of the system do not change based on location. Experiments done with odd-ordered Lagrange interpolators showed that better behaviour is observed when points are added / removed closer to the boundaries. 

\subsection{Displacement Correction}\label{sec:dispCorrRes}
In the experiments, parameters in Eq. \eqref{eq:dispCorrForce} are set to $\omega_0 = \sigma_0 = 1$. The displacement correction has a low-pass comb filtering effect on the system, where the position and amount of notches directly relates to the position of where grid points are added and removed. The best behaviour, i.e., least affecting lower frequencies, is when $M = N - 1$ and only has one notch as shown in Figures \ref{fig:modalAnalysis} and \ref{fig:spectrogramDamp}.

Experiments with different rates of change in $c$ showed that artefacts appeared when the highest mode is not attenuated as a grid point is removed.
% As mentioned in Section \ref{sec:dispCorr}, the displacement correction works with low-speed parameter changes and indeed removes artefacts when grid points are removed. Analysis of a static system with non-integer $N$ does, however, show that the correction has a low-pass comb-filtering effect on the system. The filtering is stronger for a lower values of $\epsilon$ and $\alpha$. The location and amount of the notches is determined by the location of the inner boundaries along the grid, i.e., where along the grid the displacement correction is applied. The amount of notches is equal to $\text{min}(M, M_w)$.
%Notches appear at ca. $m_\text{f}f_\text{s}/{2M_\text{min}}$ Hz and undamped frequencies right in between those, where notch number $m_\text{f} = [1, \hdots, M_\text{min}]$ and $M_\text{min} = \text{min}(M,M_w)$ is the minimum distance in points between the boundary and the location of adding and removing. 
% For a dynamic system, the notches move around the frequency spectrum and overall yield a low-passing effect.

\subsection{Limit on Rate of Change of $c$}
The current implementation of the proposed method can only add or remove a maximum one point per sample using Eqs. \eqref{eq:addingPoint} and \eqref{eq:removingPoint}. The speed of decreasing $f_0$ according to \eqref{eq:fundamentalFreq} is thus limited by $|\Nfrac^n - \Nfrac^{n-1}| \leq 1$. Though this is the maximum limitation on speed, a much lower limitation needs to be placed to keep the system well-behaved. The usual stability and energy analyses performed on FDSs are not valid anymore in the time-varying case. Frozen coefficient analysis as in \cite{Strikwerda1989} could be applied here and hold for slowly varying coefficients, but is left for future work. 
% Notes:
% In the case that $\alpha = 0$ in Eq. \eqref{eq:totalSystem} (and thus $x_{u_M} = x_{w_0}$), one could go up to adding two points at a time by adding $u_{M+1}^n$ according to Eq. \eqref{eq:addingPoint} and adding an extra point $u_{M+2}^n$ using \eqref{eq:calcVirtualGridPoints} (in this case $u_{M+2}^n = w_0^n$). This would, however, not work if $\alpha \neq 0$, as a point added to $\mathbf{u}^n$ with $x_\text{i} < w_0$ needs interpolator \eqref{eq:customIp} and $\alpha'$ would be greater than $1$. As Eq. \eqref{eq:customIp} only works if $0\leq \alpha' \leq 1$, it is best to abide condition \eqref{eq:pointCondition} to be safe. 

% No speed limit if
% \begin{equation}
%     \text{floor}(N^n) = \text{floor}(N^{n-1})\Rightarrow M^n = M^{n-1},
% \end{equation}
% i.e., if no points are added or removed from the system. 